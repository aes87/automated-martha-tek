; Martha Tent Controller — PlatformIO configuration
; Two environments:
;   esp32dev  — hardware build (ESP32 DevKit V1)
;   native    — PC unit tests via Unity (no ESP32 needed)

[platformio]
default_envs = esp32dev

; ── Common settings ────────────────────────────────────────────────────────────
[env]
build_flags =
    -Wall
    -Wextra
    -Werror
    -DMARTHA_FW_VERSION=\"0.1.0\"

; ── ESP32 hardware target ───────────────────────────────────────────────────────
[env:esp32dev]
platform  = espressif32
board     = esp32dev
framework = arduino

monitor_speed = 115200
upload_speed  = 921600

build_flags =
    ${env.build_flags}
    -DBOARD_V1
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_240=1

board_build.filesystem = littlefs

lib_deps =
    sensirion/Sensirion I2C SCD30@^3.1.0
    sensirion/Sensirion Core@^0.7.1
    sensirion/arduino-sht@^1.2.2
    robtillaart/TCA9548@0.3.0
    adafruit/Adafruit AS7341@^1.2.5
    adafruit/Adafruit BusIO@^1.16.1
    paulstoffregen/OneWire@^2.3.7
    milesburton/DallasTemperature@^3.11.0
    esp32async/ESPAsyncWebServer@^3.6.0
    ayushsharma82/ElegantOTA@^3.1.7
    bblanchon/ArduinoJson@7.4.2

; ── S3 variant (future hardware revision) ──────────────────────────────────────
[env:esp32s3]
platform  = espressif32
board     = esp32-s3-devkitc-1
framework = arduino

monitor_speed = 115200
upload_speed  = 921600

build_flags =
    ${env.build_flags}
    -DBOARD_S3
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_240=1

board_build.filesystem = littlefs

lib_deps = ${env:esp32dev.lib_deps}

; ── Native unit tests (runs on PC, no ESP32 needed) ────────────────────────────
[env:native]
platform = native

build_flags =
    -DNATIVE_TEST
    -DUNITY_INCLUDE_CONFIG_H
    -std=c++17
    -I include
    -I src

test_framework = unity
test_build_src = yes

; Exclude hardware-specific sources from native build
build_src_filter =
    +<util/rolling_average.h>
    +<util/logger.cpp>
    +<relay/relay_channel.h>
    +<relay/relay_manager.cpp>
    +<control/vpd.h>
    +<control/humidity_loop.cpp>
    +<control/co2_loop.cpp>
    +<control/timer_scheduler.cpp>
    +<sensors/water_level.cpp>
